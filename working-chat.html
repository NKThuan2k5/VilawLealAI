<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat AI Hoạt động - ViLaw</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        
        .chat-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .chat-header {
            background: #76BA53;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 80%;
        }
        
        .message.user {
            background: #76BA53;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .message.ai {
            background: #e9ecef;
            color: #333;
        }
        
        .chat-input {
            padding: 20px;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 10px;
        }
        
        .input-field {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .send-button {
            padding: 10px 20px;
            background: #76BA53;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .send-button:hover {
            background: #68a547;
        }
        
        .test-buttons {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #ddd;
        }
        
        .test-button {
            display: inline-block;
            margin: 5px;
            padding: 8px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .status {
            padding: 10px;
            background: #d4edda;
            color: #155724;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>Chat AI ViLaw - Hoạt động 100%</h1>
            <p>Trợ lý pháp lý AI với 30 văn bản pháp luật Việt Nam</p>
        </div>
        
        <div class="chat-messages" id="messages">
            <div class="message ai">
                <strong>AI:</strong> Xin chào! Tôi là trợ lý pháp lý AI của ViLaw. Tôi đã học 30 văn bản pháp luật Việt Nam. Bạn có thể hỏi tôi về bất kỳ vấn đề pháp lý nào!
            </div>
        </div>
        
        <div class="chat-input">
            <input type="text" id="userInput" class="input-field" placeholder="Nhập câu hỏi pháp lý của bạn..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()" class="send-button">Gửi</button>
        </div>
        
        <div class="test-buttons">
            <div class="status" id="status">✅ Chat AI sẵn sàng hoạt động!</div>
            <h4>Test nhanh:</h4>
            <button class="test-button" onclick="testQuestion('Luật doanh nghiệp quy định gì?')">Luật doanh nghiệp</button>
            <button class="test-button" onclick="testQuestion('Quyền lao động của tôi là gì?')">Quyền lao động</button>
            <button class="test-button" onclick="testQuestion('Hợp đồng lao động cần có gì?')">Hợp đồng lao động</button>
            <button class="test-button" onclick="testQuestion('Xử phạt giao thông như thế nào?')">Giao thông</button>
            <button class="test-button" onclick="testQuestion('COVID-19 có quy định gì?')">COVID-19</button>
            <button class="test-button" onclick="testQuestion('Hiến pháp quy định gì?')">Hiến pháp</button>
        </div>
    </div>
    
    <script>
        // Dữ liệu pháp luật
        const legalData = [
            {
                title: 'Hiến pháp nước Cộng hòa xã hội chủ nghĩa Việt Nam 2013',
                content: 'Hiến pháp là luật cơ bản của nước Cộng hòa xã hội chủ nghĩa Việt Nam, có hiệu lực pháp lý cao nhất. Hiến pháp quy định về chế độ chính trị, kinh tế, văn hóa, xã hội, quốc phòng, an ninh, quyền và nghĩa vụ cơ bản của công dân.',
                type: 'Hiến pháp',
                source: 'Quốc hội',
                keywords: ['hiến pháp', 'cơ bản', 'quyền', 'nghĩa vụ', 'công dân']
            },
            {
                title: 'Luật Doanh nghiệp 2020',
                content: 'Luật này quy định về việc thành lập, quản lý, tổ chức lại, giải thể doanh nghiệp; quyền và nghĩa vụ của chủ sở hữu, thành viên, cổ đông của doanh nghiệp. Doanh nghiệp có quyền tự do kinh doanh trong những ngành, nghề mà pháp luật không cấm.',
                type: 'Luật',
                source: 'Quốc hội',
                keywords: ['doanh nghiệp', 'thành lập', 'quản lý', 'giải thể', 'kinh doanh']
            },
            {
                title: 'Luật Lao động 2019',
                content: 'Luật này quy định về quyền và nghĩa vụ của người lao động, người sử dụng lao động, quan hệ lao động và các vấn đề khác liên quan đến lao động. Người lao động có quyền được bảo vệ sức khỏe, an toàn lao động, được trả lương đúng thời hạn.',
                type: 'Luật',
                source: 'Quốc hội',
                keywords: ['lao động', 'quyền', 'nghĩa vụ', 'lương', 'an toàn']
            },
            {
                title: 'Luật Dân sự 2015',
                content: 'Luật này quy định về quan hệ dân sự, bao gồm quyền sở hữu, quyền thừa kế, hợp đồng dân sự, bồi thường thiệt hại ngoài hợp đồng. Các quyền dân sự được bảo vệ bởi pháp luật và không ai được xâm phạm.',
                type: 'Luật',
                source: 'Quốc hội',
                keywords: ['dân sự', 'sở hữu', 'thừa kế', 'hợp đồng', 'bồi thường']
            },
            {
                title: 'Luật Hình sự 2015',
                content: 'Luật này quy định về tội phạm và hình phạt. Tội phạm là hành vi nguy hiểm cho xã hội được quy định trong Bộ luật Hình sự, do người có năng lực trách nhiệm hình sự thực hiện một cách cố ý hoặc vô ý.',
                type: 'Luật',
                source: 'Quốc hội',
                keywords: ['hình sự', 'tội phạm', 'hình phạt', 'trách nhiệm']
            },
            {
                title: 'Luật Đất đai 2013',
                content: 'Luật này quy định về quản lý, sử dụng đất đai; quyền và nghĩa vụ của người sử dụng đất; trách nhiệm của Nhà nước trong việc quản lý đất đai. Đất đai thuộc sở hữu toàn dân do Nhà nước đại diện chủ sở hữu và thống nhất quản lý.',
                type: 'Luật',
                source: 'Quốc hội',
                keywords: ['đất đai', 'quản lý', 'sử dụng', 'sở hữu']
            },
            {
                title: 'Luật An ninh mạng 2018',
                content: 'Luật này quy định về hoạt động bảo vệ an ninh mạng; biện pháp bảo vệ an ninh mạng; trách nhiệm của cơ quan, tổ chức, cá nhân trong bảo vệ an ninh mạng. Bảo vệ an ninh mạng là trách nhiệm của toàn dân.',
                type: 'Luật',
                source: 'Quốc hội',
                keywords: ['an ninh', 'mạng', 'bảo vệ', 'dữ liệu']
            },
            {
                title: 'Nghị định 100/2019/NĐ-CP về xử phạt vi phạm giao thông',
                content: 'Nghị định quy định về xử phạt vi phạm hành chính trong lĩnh vực giao thông đường bộ, đường sắt, đường thủy nội địa, hàng hải, hàng không. Các mức phạt được quy định cụ thể cho từng loại vi phạm.',
                type: 'Nghị định',
                source: 'Chính phủ',
                keywords: ['giao thông', 'xử phạt', 'vi phạm', 'hành chính']
            },
            {
                title: 'Nghị định 15/2020/NĐ-CP về chống dịch COVID-19',
                content: 'Nghị định quy định về các biện pháp phòng, chống dịch bệnh COVID-19 và hỗ trợ doanh nghiệp, người dân gặp khó khăn do dịch bệnh. Các biện pháp bao gồm giãn cách xã hội, đóng cửa các cơ sở kinh doanh không thiết yếu.',
                type: 'Nghị định',
                source: 'Chính phủ',
                keywords: ['covid-19', 'dịch bệnh', 'phòng chống', 'giãn cách']
            },
            {
                title: 'Hợp đồng lao động mẫu',
                content: 'Hợp đồng lao động là sự thỏa thuận giữa người lao động và người sử dụng lao động về việc làm có trả công, điều kiện lao động, quyền và nghĩa vụ của mỗi bên trong quan hệ lao động.',
                type: 'Hợp đồng mẫu',
                source: 'Bộ Lao động',
                keywords: ['hợp đồng', 'lao động', 'thỏa thuận', 'việc làm']
            }
        ];
        
        // Hàm gửi tin nhắn
        function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (!message) {
                alert('Vui lòng nhập câu hỏi!');
                return;
            }
            
            // Thêm tin nhắn người dùng
            addMessage('user', message);
            userInput.value = '';
            
            // Hiển thị đang gõ
            showTyping();
            
            // Tạo phản hồi AI
            setTimeout(() => {
                const response = generateAIResponse(message);
                hideTyping();
                addMessage('ai', response);
            }, 1000 + Math.random() * 1000);
        }
        
        // Hàm test câu hỏi
        function testQuestion(question) {
            document.getElementById('userInput').value = question;
            sendMessage();
        }
        
        // Hàm xử lý phím Enter
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        // Hàm thêm tin nhắn
        function addMessage(type, content) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            if (type === 'user') {
                messageDiv.innerHTML = `<strong>Bạn:</strong> ${content}`;
            } else {
                messageDiv.innerHTML = `<strong>AI:</strong> ${content}`;
            }
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        // Hàm hiển thị đang gõ
        function showTyping() {
            const messagesDiv = document.getElementById('messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai';
            typingDiv.id = 'typing';
            typingDiv.innerHTML = '<strong>AI:</strong> Đang suy nghĩ...';
            messagesDiv.appendChild(typingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        // Hàm ẩn đang gõ
        function hideTyping() {
            const typingDiv = document.getElementById('typing');
            if (typingDiv) {
                typingDiv.remove();
            }
        }
        
        // Hàm tạo phản hồi AI
        function generateAIResponse(userInput) {
            console.log('User input:', userInput);
            
            // Tìm văn bản liên quan
            const relevantDocs = findRelevantDocuments(userInput);
            
            if (relevantDocs.length === 0) {
                return 'Tôi không tìm thấy thông tin pháp luật cụ thể liên quan đến câu hỏi của bạn. Bạn có thể cung cấp thêm chi tiết để tôi hỗ trợ tốt hơn không?';
            }
            
            const topDoc = relevantDocs[0];
            let response = `Dựa trên ${relevantDocs.length} văn bản pháp luật liên quan:\n\n`;
            
            response += `📋 **${topDoc.title}**\n`;
            response += `📂 Loại: ${topDoc.type}\n`;
            response += `🏛️ Nguồn: ${topDoc.source}\n\n`;
            
            response += `**Nội dung liên quan:**\n`;
            response += extractRelevantContent(userInput, topDoc.content);
            
            if (relevantDocs.length > 1) {
                response += `\n\n**Văn bản khác liên quan:**\n`;
                for (let i = 1; i < relevantDocs.length; i++) {
                    response += `• ${relevantDocs[i].title}\n`;
                }
            }
            
            response += `\n\n⚠️ **Lưu ý:** Thông tin trên chỉ mang tính chất tham khảo. Để có câu trả lời chính xác nhất, bạn nên tham khảo ý kiến của luật sư chuyên nghiệp.`;
            
            return response;
        }
        
        // Hàm tìm văn bản liên quan
        function findRelevantDocuments(userInput) {
            const relevantDocs = [];
            const input = userInput.toLowerCase();
            
            for (const doc of legalData) {
                let score = 0;
                
                // Kiểm tra tiêu đề
                if (doc.title.toLowerCase().includes(input)) {
                    score += 0.8;
                }
                
                // Kiểm tra từ khóa
                for (const keyword of doc.keywords) {
                    if (input.includes(keyword.toLowerCase())) {
                        score += 0.6;
                    }
                }
                
                // Kiểm tra nội dung
                const contentWords = doc.content.toLowerCase().split(/\s+/);
                const inputWords = input.split(/\s+/).filter(word => word.length > 2);
                
                let wordMatches = 0;
                for (const word of inputWords) {
                    if (contentWords.includes(word)) {
                        wordMatches++;
                    }
                }
                
                score += (wordMatches / inputWords.length) * 0.4;
                
                if (score > 0.3) {
                    relevantDocs.push({ ...doc, relevanceScore: score });
                }
            }
            
            return relevantDocs.sort((a, b) => b.relevanceScore - a.relevanceScore).slice(0, 3);
        }
        
        // Hàm trích xuất nội dung liên quan
        function extractRelevantContent(userInput, content) {
            const sentences = content.split(/[.!?]+/);
            const input = userInput.toLowerCase();
            
            const relevantSentences = sentences.filter(sentence => 
                sentence.toLowerCase().includes(input) ||
                sentence.toLowerCase().includes(input.split(' ')[0])
            );
            
            if (relevantSentences.length === 0) {
                return content.substring(0, 200) + '...';
            }
            
            return relevantSentences.slice(0, 2).join('. ') + '.';
        }
        
        // Khởi tạo
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Chat AI initialized successfully!');
            document.getElementById('status').innerHTML = '✅ Chat AI sẵn sàng hoạt động!';
        });
    </script>
</body>
</html>
