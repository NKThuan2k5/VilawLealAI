<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test AI Chat - ViLaw</title>
    <style>
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: #EFF2F0;
            margin: 0;
            padding: 20px;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .test-header {
            background: #76BA53;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .test-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }
        
        .chat-section {
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .chat-header {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            padding: 15px;
        }
        
        .message {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 8px;
        }
        
        .message.user {
            background: #76BA53;
            color: white;
            margin-left: auto;
            max-width: 80%;
        }
        
        .message.ai {
            background: #f0f0f0;
            color: #333;
            max-width: 80%;
        }
        
        .chat-input {
            padding: 15px;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 10px;
        }
        
        .input-field {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .send-button {
            padding: 8px 16px;
            background: #76BA53;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .test-section {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
        }
        
        .test-button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            text-align: left;
        }
        
        .test-button:hover {
            background: #e9ecef;
        }
        
        .debug-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
        }
        
        @media (max-width: 768px) {
            .test-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>Test AI Chat ViLaw</h1>
            <p>Ki·ªÉm tra kh·∫£ nƒÉng tr·∫£ l·ªùi c·ªßa AI</p>
        </div>
        
        <div class="test-content">
            <div class="chat-section">
                <div class="chat-header">
                    <h3>Chat AI</h3>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <strong>AI:</strong> Xin ch√†o! T√¥i l√† tr·ª£ l√Ω ph√°p l√Ω AI. H√£y th·ª≠ c√°c c√¢u h·ªèi test b√™n c·∫°nh ho·∫∑c t·ª± h·ªèi!
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="messageInput" class="input-field" placeholder="Nh·∫≠p c√¢u h·ªèi...">
                    <button id="sendButton" class="send-button">G·ª≠i</button>
                </div>
            </div>
            
            <div class="test-section">
                <h3>C√¢u h·ªèi Test</h3>
                <button class="test-button" onclick="testAI('Lu·∫≠t doanh nghi·ªáp quy ƒë·ªãnh g√¨?')">
                    Lu·∫≠t doanh nghi·ªáp quy ƒë·ªãnh g√¨?
                </button>
                <button class="test-button" onclick="testAI('Quy·ªÅn lao ƒë·ªông c·ªßa t√¥i l√† g√¨?')">
                    Quy·ªÅn lao ƒë·ªông c·ªßa t√¥i l√† g√¨?
                </button>
                <button class="test-button" onclick="testAI('H·ª£p ƒë·ªìng lao ƒë·ªông c·∫ßn c√≥ g√¨?')">
                    H·ª£p ƒë·ªìng lao ƒë·ªông c·∫ßn c√≥ g√¨?
                </button>
                <button class="test-button" onclick="testAI('Quy·ªÅn th·ª´a k·∫ø ƒë∆∞·ª£c quy ƒë·ªãnh nh∆∞ th·∫ø n√†o?')">
                    Quy·ªÅn th·ª´a k·∫ø ƒë∆∞·ª£c quy ƒë·ªãnh nh∆∞ th·∫ø n√†o?
                </button>
                <button class="test-button" onclick="testAI('H√¥n nh√¢n v√† gia ƒë√¨nh c√≥ quy ƒë·ªãnh g√¨?')">
                    H√¥n nh√¢n v√† gia ƒë√¨nh c√≥ quy ƒë·ªãnh g√¨?
                </button>
                <button class="test-button" onclick="testAI('X·ª≠ ph·∫°t giao th√¥ng nh∆∞ th·∫ø n√†o?')">
                    X·ª≠ ph·∫°t giao th√¥ng nh∆∞ th·∫ø n√†o?
                </button>
                <button class="test-button" onclick="testAI('COVID-19 c√≥ quy ƒë·ªãnh g√¨?')">
                    COVID-19 c√≥ quy ƒë·ªãnh g√¨?
                </button>
                <button class="test-button" onclick="testAI('T√¥i mu·ªën th√†nh l·∫≠p c√¥ng ty')">
                    T√¥i mu·ªën th√†nh l·∫≠p c√¥ng ty
                </button>
            </div>
        </div>
        
        <div class="debug-info" id="debugInfo">
            <strong>Debug Info:</strong><br>
            <span id="debugText">Ch·ªù kh·ªüi t·∫°o...</span>
        </div>
    </div>
    
    <script>
        class TestAIChat {
            constructor() {
                this.chatMessages = document.getElementById('chatMessages');
                this.messageInput = document.getElementById('messageInput');
                this.sendButton = document.getElementById('sendButton');
                this.debugText = document.getElementById('debugText');
                this.legalData = this.getSampleLegalData();
                
                this.init();
            }
            
            init() {
                console.log('Initializing TestAIChat...');
                this.debugText.textContent = 'AI Chat ƒë√£ kh·ªüi t·∫°o th√†nh c√¥ng!';
                
                this.sendButton.addEventListener('click', () => this.sendMessage());
                this.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });
                
                console.log('TestAIChat initialized successfully');
            }
            
            sendMessage() {
                const message = this.messageInput.value.trim();
                if (!message) return;
                
                this.addMessage('user', message);
                this.messageInput.value = '';
                
                setTimeout(() => {
                    const response = this.generateAIResponse(message);
                    this.addMessage('ai', response);
                }, 1000 + Math.random() * 1000);
            }
            
            addMessage(type, content) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                
                if (type === 'user') {
                    messageDiv.innerHTML = `<strong>B·∫°n:</strong> ${content}`;
                } else {
                    messageDiv.innerHTML = `<strong>AI:</strong> ${content}`;
                }
                
                this.chatMessages.appendChild(messageDiv);
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }
            
            generateAIResponse(userInput) {
                console.log('Generating response for:', userInput);
                
                // Find relevant documents
                const relevantDocs = this.findRelevantDocuments(userInput);
                const intent = this.analyzeUserIntent(userInput);
                
                if (relevantDocs.length === 0) {
                    return this.generateGeneralResponse(intent);
                }
                
                const topDoc = relevantDocs[0];
                let response = `D·ª±a tr√™n ${relevantDocs.length} vƒÉn b·∫£n ph√°p lu·∫≠t li√™n quan:\n\n`;
                
                response += `üìã **${topDoc.title}**\n`;
                response += `üìÖ Ng√†y: ${new Date(topDoc.date).toLocaleDateString('vi-VN')}\n`;
                response += `üìÇ Lo·∫°i: ${topDoc.type}\n`;
                response += `üèõÔ∏è Ngu·ªìn: ${topDoc.source}\n\n`;
                
                response += `**N·ªôi dung li√™n quan:**\n`;
                response += this.extractRelevantContent(userInput, topDoc.content);
                
                if (relevantDocs.length > 1) {
                    response += `\n\n**VƒÉn b·∫£n kh√°c:**\n`;
                    for (let i = 1; i < relevantDocs.length; i++) {
                        response += `‚Ä¢ ${relevantDocs[i].title}\n`;
                    }
                }
                
                response += `\n\n‚ö†Ô∏è **L∆∞u √Ω:** Th√¥ng tin tham kh·∫£o. Tham kh·∫£o lu·∫≠t s∆∞ ƒë·ªÉ c√≥ c√¢u tr·∫£ l·ªùi ch√≠nh x√°c.`;
                
                return response;
            }
            
            findRelevantDocuments(userInput) {
                const relevantDocs = [];
                
                for (const doc of this.legalData) {
                    const score = this.calculateRelevanceScore(userInput, doc);
                    if (score > 0.3) {
                        relevantDocs.push({ ...doc, relevanceScore: score });
                    }
                }
                
                return relevantDocs.sort((a, b) => b.relevanceScore - a.relevanceScore).slice(0, 3);
            }
            
            calculateRelevanceScore(userInput, document) {
                const input = userInput.toLowerCase();
                const title = document.title.toLowerCase();
                const content = document.content.toLowerCase();
                const keywords = document.keywords || [];
                
                let score = 0;
                
                // Title match
                if (title.includes(input)) {
                    score += 0.8;
                }
                
                // Keyword matches
                for (const keyword of keywords) {
                    if (input.includes(keyword.toLowerCase())) {
                        score += 0.6;
                    }
                }
                
                // Content word matches
                const inputWords = input.split(/\s+/).filter(word => word.length > 2);
                const contentWords = content.split(/\s+/);
                
                let wordMatches = 0;
                for (const word of inputWords) {
                    if (contentWords.includes(word)) {
                        wordMatches++;
                    }
                }
                
                score += (wordMatches / inputWords.length) * 0.4;
                
                return Math.min(score, 1.0);
            }
            
            analyzeUserIntent(userInput) {
                const input = userInput.toLowerCase();
                
                if (input.includes('lu·∫≠t') || input.includes('quy ƒë·ªãnh')) {
                    return 'legal_inquiry';
                } else if (input.includes('h·ª£p ƒë·ªìng')) {
                    return 'contract_inquiry';
                } else if (input.includes('lao ƒë·ªông')) {
                    return 'labor_inquiry';
                } else if (input.includes('doanh nghi·ªáp') || input.includes('c√¥ng ty')) {
                    return 'business_inquiry';
                } else if (input.includes('h√¥n nh√¢n') || input.includes('gia ƒë√¨nh')) {
                    return 'family_inquiry';
                } else if (input.includes('th·ª´a k·∫ø') || input.includes('t√†i s·∫£n')) {
                    return 'property_inquiry';
                } else {
                    return 'general_inquiry';
                }
            }
            
            generateGeneralResponse(intent) {
                const responses = {
                    'legal_inquiry': 'T√¥i hi·ªÉu b·∫°n ƒëang t√¨m hi·ªÉu v·ªÅ ph√°p lu·∫≠t. B·∫°n c√≥ th·ªÉ cung c·∫•p th√™m chi ti·∫øt v·ªÅ lƒ©nh v·ª±c c·ª• th·ªÉ kh√¥ng?',
                    'contract_inquiry': 'V·ªÅ h·ª£p ƒë·ªìng, t√¥i c√≥ th·ªÉ gi√∫p b·∫°n hi·ªÉu c√°c quy ƒë·ªãnh c∆° b·∫£n. B·∫°n c√≥ th·ªÉ m√¥ t·∫£ c·ª• th·ªÉ h∆°n kh√¥ng?',
                    'labor_inquiry': 'V·ªÅ quy·ªÅn lao ƒë·ªông, t√¥i c√≥ th·ªÉ cung c·∫•p th√¥ng tin v·ªÅ c√°c quy ƒë·ªãnh. B·∫°n c√≥ th·ªÉ chia s·∫ª th√™m chi ti·∫øt kh√¥ng?',
                    'business_inquiry': 'V·ªÅ ph√°p lu·∫≠t doanh nghi·ªáp, t√¥i c√≥ th·ªÉ h·ªó tr·ª£ b·∫°n. B·∫°n ƒëang quan t√¢m ƒë·∫øn kh√≠a c·∫°nh n√†o?',
                    'family_inquiry': 'V·ªÅ h√¥n nh√¢n v√† gia ƒë√¨nh, t√¥i c√≥ th·ªÉ cung c·∫•p th√¥ng tin c∆° b·∫£n. B·∫°n c√≥ th·ªÉ m√¥ t·∫£ t√¨nh hu·ªëng kh√¥ng?',
                    'property_inquiry': 'V·ªÅ quy·ªÅn t√†i s·∫£n v√† th·ª´a k·∫ø, t√¥i c√≥ th·ªÉ gi√∫p b·∫°n. B·∫°n c√≥ th·ªÉ chia s·∫ª th√™m chi ti·∫øt kh√¥ng?',
                    'general_inquiry': 'T√¥i l√† tr·ª£ l√Ω ph√°p l√Ω AI. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n t√¨m hi·ªÉu v·ªÅ ph√°p lu·∫≠t Vi·ªát Nam!'
                };
                
                return responses[intent] || responses['general_inquiry'];
            }
            
            extractRelevantContent(userInput, content) {
                const sentences = content.split(/[.!?]+/);
                const relevantSentences = sentences.filter(sentence => 
                    sentence.toLowerCase().includes(userInput.toLowerCase()) ||
                    this.calculateRelevanceScore(userInput, { content: sentence }) > 0.2
                );
                
                return relevantSentences.slice(0, 2).join('. ') + '.';
            }
            
            getSampleLegalData() {
                return [
                    {
                        id: 'doc_1',
                        title: 'Lu·∫≠t Doanh nghi·ªáp 2020',
                        content: 'Lu·∫≠t n√†y quy ƒë·ªãnh v·ªÅ vi·ªác th√†nh l·∫≠p, qu·∫£n l√Ω, t·ªï ch·ª©c l·∫°i, gi·∫£i th·ªÉ doanh nghi·ªáp; quy·ªÅn v√† nghƒ©a v·ª• c·ªßa ch·ªß s·ªü h·ªØu, th√†nh vi√™n, c·ªï ƒë√¥ng c·ªßa doanh nghi·ªáp. Doanh nghi·ªáp c√≥ quy·ªÅn t·ª± do kinh doanh trong nh·ªØng ng√†nh, ngh·ªÅ m√† ph√°p lu·∫≠t kh√¥ng c·∫•m.',
                        type: 'Lu·∫≠t',
                        source: 'Qu·ªëc h·ªôi',
                        date: '2020-06-17T00:00:00.000Z',
                        keywords: ['doanh nghi·ªáp', 'th√†nh l·∫≠p', 'qu·∫£n l√Ω', 'gi·∫£i th·ªÉ', 'kinh doanh']
                    },
                    {
                        id: 'doc_2',
                        title: 'Lu·∫≠t Lao ƒë·ªông 2019',
                        content: 'Lu·∫≠t n√†y quy ƒë·ªãnh v·ªÅ quy·ªÅn v√† nghƒ©a v·ª• c·ªßa ng∆∞·ªùi lao ƒë·ªông, ng∆∞·ªùi s·ª≠ d·ª•ng lao ƒë·ªông, quan h·ªá lao ƒë·ªông. Ng∆∞·ªùi lao ƒë·ªông c√≥ quy·ªÅn ƒë∆∞·ª£c b·∫£o v·ªá s·ª©c kh·ªèe, an to√†n lao ƒë·ªông, ƒë∆∞·ª£c tr·∫£ l∆∞∆°ng ƒë√∫ng th·ªùi h·∫°n, ƒë∆∞·ª£c ngh·ªâ ph√©p, ngh·ªâ l·ªÖ theo quy ƒë·ªãnh.',
                        type: 'Lu·∫≠t',
                        source: 'Qu·ªëc h·ªôi',
                        date: '2019-11-20T00:00:00.000Z',
                        keywords: ['lao ƒë·ªông', 'quy·ªÅn', 'nghƒ©a v·ª•', 'l∆∞∆°ng', 'ngh·ªâ ph√©p']
                    },
                    {
                        id: 'doc_3',
                        title: 'Lu·∫≠t D√¢n s·ª± 2015',
                        content: 'Lu·∫≠t n√†y quy ƒë·ªãnh v·ªÅ quan h·ªá d√¢n s·ª±, bao g·ªìm quy·ªÅn s·ªü h·ªØu, quy·ªÅn th·ª´a k·∫ø, h·ª£p ƒë·ªìng d√¢n s·ª±, b·ªìi th∆∞·ªùng thi·ªát h·∫°i. C√°c quy·ªÅn d√¢n s·ª± ƒë∆∞·ª£c b·∫£o v·ªá b·ªüi ph√°p lu·∫≠t.',
                        type: 'Lu·∫≠t',
                        source: 'Qu·ªëc h·ªôi',
                        date: '2015-11-24T00:00:00.000Z',
                        keywords: ['d√¢n s·ª±', 's·ªü h·ªØu', 'th·ª´a k·∫ø', 'h·ª£p ƒë·ªìng', 'b·ªìi th∆∞·ªùng']
                    },
                    {
                        id: 'doc_4',
                        title: 'Lu·∫≠t H√¥n nh√¢n v√† Gia ƒë√¨nh 2014',
                        content: 'Lu·∫≠t n√†y quy ƒë·ªãnh v·ªÅ h√¥n nh√¢n v√† gia ƒë√¨nh; quy·ªÅn, nghƒ©a v·ª• c·ªßa v·ª£, ch·ªìng, cha, m·∫π, con; tr√°ch nhi·ªám trong vi·ªác x√¢y d·ª±ng ch·∫ø ƒë·ªô h√¥n nh√¢n v√† gia ƒë√¨nh.',
                        type: 'Lu·∫≠t',
                        source: 'Qu·ªëc h·ªôi',
                        date: '2014-06-19T00:00:00.000Z',
                        keywords: ['h√¥n nh√¢n', 'gia ƒë√¨nh', 'v·ª£ ch·ªìng', 'cha m·∫π', 'con c√°i']
                    },
                    {
                        id: 'doc_5',
                        title: 'Ngh·ªã ƒë·ªãnh 15/2020/Nƒê-CP v·ªÅ COVID-19',
                        content: 'Ngh·ªã ƒë·ªãnh quy ƒë·ªãnh v·ªÅ c√°c bi·ªán ph√°p ph√≤ng, ch·ªëng d·ªãch b·ªánh COVID-19 v√† h·ªó tr·ª£ doanh nghi·ªáp, ng∆∞·ªùi d√¢n g·∫∑p kh√≥ khƒÉn do d·ªãch b·ªánh.',
                        type: 'Ngh·ªã ƒë·ªãnh',
                        source: 'Ch√≠nh ph·ªß',
                        date: '2020-04-03T00:00:00.000Z',
                        keywords: ['covid-19', 'd·ªãch b·ªánh', 'h·ªó tr·ª£', 'doanh nghi·ªáp']
                    },
                    {
                        id: 'doc_6',
                        title: 'Ngh·ªã ƒë·ªãnh 100/2019/Nƒê-CP v·ªÅ giao th√¥ng',
                        content: 'Ngh·ªã ƒë·ªãnh quy ƒë·ªãnh v·ªÅ x·ª≠ ph·∫°t vi ph·∫°m h√†nh ch√≠nh trong lƒ©nh v·ª±c giao th√¥ng ƒë∆∞·ªùng b·ªô, ƒë∆∞·ªùng s·∫Øt, ƒë∆∞·ªùng th·ªßy n·ªôi ƒë·ªãa, h√†ng h·∫£i, h√†ng kh√¥ng.',
                        type: 'Ngh·ªã ƒë·ªãnh',
                        source: 'Ch√≠nh ph·ªß',
                        date: '2019-12-30T00:00:00.000Z',
                        keywords: ['giao th√¥ng', 'x·ª≠ ph·∫°t', 'vi ph·∫°m', 'h√†nh ch√≠nh']
                    }
                ];
            }
        }
        
        // Global function for testing
        function testAI(question) {
            if (window.testChat) {
                window.testChat.addMessage('user', question);
                setTimeout(() => {
                    const response = window.testChat.generateAIResponse(question);
                    window.testChat.addMessage('ai', response);
                }, 1000);
            }
        }
        
        // Initialize chat
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing test chat...');
            window.testChat = new TestAIChat();
            console.log('Test chat initialized:', window.testChat);
        });
    </script>
</body>
</html>
